<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>PropBot • Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100">
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-2xl font-semibold mb-4">PropBot — Dashboard (Phase-1)</h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="rounded-2xl bg-slate-900 p-4 shadow">
        <div class="text-sm text-slate-400">Health</div>
        <pre id="health" class="text-xs mt-2 whitespace-pre-wrap"></pre>
      </div>
      <div class="rounded-2xl bg-slate-900 p-4 shadow">
        <div class="text-sm text-slate-400">Readiness</div>
        <pre id="ready" class="text-xs mt-2 whitespace-pre-wrap"></pre>
      </div>
      <div class="rounded-2xl bg-slate-900 p-4 shadow">
        <div class="text-sm text-slate-400">PNL</div>
        <pre id="pnl" class="text-xs mt-2 whitespace-pre-wrap"></pre>
      </div>
    </div>

    <div class="rounded-2xl bg-slate-900 p-4 shadow">
      <div class="flex items-center justify-between">
        <div class="text-sm text-slate-400">Opportunities</div>
        <button id="refresh" class="text-xs px-3 py-1 rounded bg-slate-800 hover:bg-slate-700">Refresh</button>
      </div>
      <table class="w-full mt-3 text-sm">
        <thead class="text-slate-400">
          <tr>
            <th class="text-left py-1">Symbol</th>
            <th class="text-left py-1">Buy</th>
            <th class="text-left py-1">Sell</th>
            <th class="text-left py-1">Spread bps</th>
            <th class="text-left py-1">Notional</th>
            <th class="text-left py-1">Ts</th>
          </tr>
        </thead>
        <tbody id="opps"></tbody>
      </table>
    </div>
  </div>

<script>
async function j(u){ const r=await fetch(u); return r.ok? r.json(): {error: r.status}; }

async function load() {
  const [h,r,o] = await Promise.all([
    j('/api/health'), j('/live-readiness'), j('/api/opportunities')
  ]);

  document.getElementById('health').textContent = JSON.stringify(h, null, 2);
  document.getElementById('ready').textContent  = JSON.stringify(r, null, 2);
  const pnl = h && h.metrics ? h.metrics : {};
  document.getElementById('pnl').textContent    = JSON.stringify(pnl, null, 2);

  const tb = document.getElementById('opps');
  tb.innerHTML = '';
  (o.opportunities || []).slice(0,20).forEach(row=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="py-1">${row.symbol||''}</td>
      <td class="py-1">${row.buy_venue||''}</td>
      <td class="py-1">${row.sell_venue||''}</td>
      <td class="py-1">${(row.spread_bps??'').toString().slice(0,8)}</td>
      <td class="py-1">${row.notional||''}</td>
      <td class="py-1">${row.timestamp||''}</td>`;
    tb.appendChild(tr);
  });
}

document.getElementById('refresh').addEventListener('click', load);
load();
</script>
</body>
</html>
